<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ИНФОРМАЦИОННАЯ САЙТА</title>
  <link rel="icon" type="image/x-icon" href="https://line-0707.github.io/Acts/favicon.ico">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f9;
      color: #333;
    }

    .header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .header img {
      width: 50px;
      height: 50px;
      margin-right: 15px;
    }

    .header h1,
    .header h2 {
      margin: 0;
    }

    .header h1 {
      font-size: 2em;
    }

    .header h1 a {
      text-decoration: none;
      color: inherit;
    }

    .header h2 {
      font-size: 1.2em;
      font-weight: normal;
      color: #555;
    }

    #table-container {
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
      /* For responsiveness */
      background-color: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
      /* Prevent text wrapping */
    }

    thead th {
      background-color: #007bff;
      color: white;
      font-weight: bold;
    }

    tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    tbody tr:hover {
      background-color: #e9ecef;
    }

    /* Style for category rows */
    .category-row {
      background-color: #6c757d;
      color: white;
      font-weight: bold;
      text-align: center !important;
    }

    .category-row:hover {
      background-color: #5a6268;
    }

    /* Style for links in the table */
    table a {
      color: #007bff;
      text-decoration: none;
      font-weight: 500;
    }

    table a:hover {
      text-decoration: underline;
    }

    .loader {
      text-align: center;
      padding: 20px;
      font-size: 1.2em;
    }
  </style>
</head>

<body>

  <div class="header">
    <img src="https://line-0707.github.io/Acts/source/icon.webp" alt="Site Icon">
    <div>
      <h1><a href="https://line-0707.github.io/Acts/index.html">ИНФОРМАЦИОННАЯ САЙТА</a></h1>
      <h2>Сводка опубликованных документов и ресурсов</h2>
    </div>
  </div>

  <div id="table-container">
    <div class="loader">Loading data from Google Sheet...</div>
  </div>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/1Rvr4RwirK8-ygKXG3Qyq6Bf4OvGZ7YjsxiAb4ZI2Xeo/gviz/tq?tqx=out:csv&sheet=Лист1';

    document.addEventListener('DOMContentLoaded', function () {
      fetch(sheetUrl)
        .then(response => response.ok ? response.text() : Promise.reject('Network response was not ok.'))
        .then(csvText => {
          const tableContainer = document.getElementById('table-container');

          // Simple CSV parser
          const rows = csvText.trim().split('\n').map(row => row.split(',').map(cell => cell.trim().replace(/^"|"$/g, '')));

          if (rows.length < 1) {
            tableContainer.textContent = 'No data found in the sheet.';
            return;
          }

          // --- LOGIC FOR HANDLING COLUMNS ---
          const headers = rows[0];
          const columnsToHide = new Set(['en', 'jp', 'link']);
          const linkColumnIndex = headers.indexOf('link');
          const filesColumnIndex = headers.indexOf('files');

          const visibleHeaders = headers.map((header, index) => ({ header, index }))
            .filter(h => !columnsToHide.has(h.header));

          // --- CREATE TABLE STRUCTURE ---
          const table = document.createElement('table');
          const thead = document.createElement('thead');
          const tbody = document.createElement('tbody');

          // Create table header
          const headerRow = document.createElement('tr');
          visibleHeaders.forEach(({ header }) => {
            const th = document.createElement('th');
            th.textContent = header;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);

          // Create table body
          for (let i = 1; i < rows.length; i++) {
            const rowData = rows[i];
            if (rowData.length === 1 && rowData[0] === '') continue; // Skip empty rows

            // Check for category row: "cat[...]"
            if (rowData[0] && rowData[0].startsWith('cat[')) {
              const match = rowData[0].match(/\[(.*?)\]/);
              if (match) {
                const tr = document.createElement('tr');
                tr.className = 'category-row';
                const td = document.createElement('td');
                td.colSpan = visibleHeaders.length;
                td.textContent = match[1]; // Text inside brackets
                tr.appendChild(td);
                tbody.appendChild(tr);
              }
            } else { // It's a regular data row
              const tr = document.createElement('tr');
              const linkUrl = (linkColumnIndex !== -1) ? rowData[linkColumnIndex] : null;

              visibleHeaders.forEach(({ index }) => {
                const td = document.createElement('td');
                const cellText = rowData[index] || '';

                // If this is the 'files' column and a link exists, create a hyperlink
                if (index === filesColumnIndex && linkUrl) {
                  const a = document.createElement('a');
                  a.href = linkUrl;
                  a.textContent = cellText;
                  a.target = '_blank'; // Open in new tab
                  a.rel = 'noopener noreferrer';
                  td.appendChild(a);
                } else {
                  td.textContent = cellText;
                }
                tr.appendChild(td);
              });
              tbody.appendChild(tr);
            }
          }

          table.appendChild(thead);
          table.appendChild(tbody);

          tableContainer.innerHTML = ''; // Clear "Loading..." message
          tableContainer.appendChild(table);
        })
        .catch(error => {
          console.error('Error fetching or parsing sheet data:', error);
          document.getElementById('table-container').textContent = 'Error: Could not load data from Google Sheet. Please ensure it is "Published to the web" as a CSV.';
        });
    });
  </script>

</body>

</html>