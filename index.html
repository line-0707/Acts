<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ИНФОРМАЦИОННАЯ САЙТА — Документы</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --bg: #f7f8fb;
      --card-light: rgba(255, 255, 255, 0.95);
      --card-dark: rgba(6, 8, 15, 0.65);
      --the: #6b7280;
      --accent: #0f172a;
      --header-bg-light: rgba(255, 255, 255, 0.85);
      --header-bg-dark: rgba(0, 0, 0, 0.5);
      --subcat-bg-light: rgba(238, 242, 247, 0.85);
      --subcat-bg-dark: rgba(255, 255, 255, 0.03);
      --title-color-light: #000;
      --title-color-dark: #fff;
      --stroke: #ffffff;
      --link-light: #0366d6;
      --link-dark: #5ab6ff;
    }

    html {
      min-height: 100%;
      background: var(--bg) url('source/light.jpg') center/cover no-repeat;
      transition: background 0.3s ease;
    }

    body {
      min-height: 100%;
      margin: 0;
      font-family: 'Noto Sans JP', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    .dark html {
      background: #071024 url('source/dark.jpg') center/cover no-repeat;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .logo {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      overflow: hidden;
      background: #e6eef9;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .logo img {
      width: auto;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      justify-content: left;
      height: 72px;
      text-align: left;
      flex-grow: 1;
    }

    .title-block-inner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      height: 100%;
    }

    .title-block h1,
    .title-block .lead {
      text-shadow: 1.5px 0 0 var(--stroke), -1.5px 0 0 var(--stroke), 0 1.5px 0 var(--stroke),
        0 -1.5px 0 var(--stroke), 1.05px 1.05px 0 var(--stroke), -1.05px 1.05px 0 var(--stroke),
        1.05px -1.05px 0 var(--stroke), -1.05px -1.05px 0 var(--stroke);
    }

    h1 {
      font-size: 20px;
      margin: 0;
    }

    p.lead {
      margin: 4px 0 0;
      font-size: 14px;
    }

    .lang-select select {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      background: #e5e7eb;
      color: #111827;
      cursor: pointer;
    }

    .card {
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.04);
      background: var(--card-light);
      transition: background 0.3s ease;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      table-layout: auto;
      /* PCでは自動幅 */
      transition: color 0.3s ease, background 0.3s ease;
    }


    #col-file {
      width: 55%;
      /* ファイル列 */
    }

    #col-status {
      width: 20%;
      /* ステータス列 */
    }

    #col-update {
      width: 25%;
      white-space: nowrap;
    }

    th,
    td {
      padding: 10px 12px;
      font-size: 14px;
      vertical-align: middle;
    }

    #col-file {
      width: 55%;
    }

    #col-status {
      width: 20%;
    }

    #col-update {
      width: 25%;
    }


    th {
      background: var(--header-bg-light);
      font-weight: 700;
      color: var(--muted);
      font-size: 13px;
    }

    tr.subcat td {
      background: var(--subcat-bg-light);
      color: var(--accent);
      font-weight: 600;
    }

    tr.divider td {
      border: none;
      padding: 0;
    }

    tr.divider td hr {
      border: none;
      border-top: 1px solid #e5e7eb;
      margin: 8px 0;
    }

    td.status {
      display: table-cell;
      text-align: left;
      white-space: nowrap;
    }

    td.status.available {
      background: #d1fae5;
      color: #065f46;
      font-weight: 600;
    }

    td.status.limited {
      background: #fef9c3;
      color: #92400e;
      font-weight: 600;
    }

    td.status.expired,
    td.status.unavailable,
    td.status.progress {
      background: #fecaca;
      color: #991b1b;
      font-weight: 600;
    }

    td a {
      color: var(--link-light);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    td a:hover {
      text-decoration: underline;
    }

    .title-link {
      color: inherit;
      text-decoration: none;
    }

    a.broken-link {
      text-decoration: line-through;
      cursor: default;
      color: #000000 !important;
    }

    .dark a.broken-link {
      color: #ffffff !important;
    }

    /* デスクトップ用フッターのスタイル */
    footer {
      margin-top: 18px;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #fff !important;
      background: rgba(0, 0, 0, 0.5);
      padding: 4px 8px;
      border-radius: 4px;
    }

    footer .last-update,
    footer #author-text {
      color: #fff !important;
      text-shadow: none !important;
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      background: var(--card-light);
      color: var(--accent);
      font-size: 24px;
      border: none;
      margin-right: 8px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .dark {
      background: #071024 url('source/dark.jpg') center/cover no-repeat;
    }

    .dark .card {
      background: var(--card-dark);
    }

    .dark table {
      color: #e6eef8;
    }

    .dark th {
      background: var(--header-bg-dark);
      color: #e6eef8;
    }

    .dark tr.subcat td {
      background: var(--subcat-bg-dark);
      color: #e6eef8;
    }

    .dark td a {
      color: var(--link-dark);
    }

    .dark .theme-toggle {
      background: var(--card-dark);
      color: #fff;
    }

    .dark #note-text {
      color: #e5e7eb;
    }

    td.status::before {
      content: '●';
      display: inline-block;
      margin-right: 8px;
      font-size: 0.85em;
      vertical-align: middle;
      opacity: 0.95;
    }

    td.status.available::before {
      color: #10b981;
    }

    td.status.limited::before {
      color: #f59e0b;
    }

    td.status.expired::before,
    td.status.unavailable::before,
    td.status.progress::before {
      color: #ef4444;
    }

    .dark td.status.available {
      background: rgba(16, 185, 129, 0.12);
      color: #d1fae5;
      font-weight: 700;
    }

    .dark td.status.limited {
      background: rgba(245, 158, 11, 0.10);
      color: #ffedd5;
      font-weight: 700;
    }

    .dark td.status.expired,
    .dark td.status.unavailable,
    .dark td.status.progress {
      background: rgba(239, 68, 68, 0.10);
      color: #ffecec;
      font-weight: 700;
    }

    /* --- モバイル表示用のスタイル --- */
    @media (max-width: 640px) {
      td.status {
        display: none;
      }

      th#col-status {
        display: none;
      }

      #col-file {
        width: 70%;
      }

      #col-update {
        width: 30%;
        white-space: normal;
      }
    }


    /* 改行許可 */
    td.file-with-status.available::before {
      color: #10b981;
    }

    td.file-with-status.limited::before {
      color: #f59e0b;
    }

    td.file-with-status.expired::before,
    td.file-with-status.unavailable::before {
      color: #ef4444;
    }

    td.file-with-status {
      position: relative;
      padding-left: 25px;
      /* 中黒分の余白 */
    }

    td.status {
      display: none;
    }

    /* 元のステータス列は非表示 */


    th,
    td {
      padding: 10px 12px;
      /* 余計な二重指定を削除 */
      text-align: left;
      font-size: 14px;
      vertical-align: middle;
    }

    td.status {
      display: table-cell;
      /* PC表示で復活 */
      white-space: nowrap;
      /* 文字を折り返さない */
    }

    /* モバイルでのフッターの改行と中央揃え */
    footer {
      flex-direction: column;
      align-items: center;
    }

    /* 修正：ヘッダーからステータス列のみを非表示にする */
    th#col-status {
      display: none;
    }

    /* 修正：モバイル表示でtd.statusを完全に非表示にする */
    td.status {
      display: flex;
      align-items: center;
      white-space: nowrap;
      padding-left: 25px;
      /* 中黒と文字の間隔 */
    }

    td.status::before {
      content: '●';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85em;
      opacity: 0.95;
    }

    td.status .status-text {
      margin-left: 8px;
      /* 中黒と文字の間隔 */
      transform: none;
    }

    /* 修正：モバイル表示でファイルと最終更新日の幅を7:3に設定 */
    #col-file {
      width: 70%;
    }

    #col-update {
      width: 30%;
    }

    /* 修正：ヘッダーのレイアウトをCSS Gridに変更 */
    header {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      justify-items: center;
    }

    .title-block {
      text-align: center;
      grid-row: 3;
    }

    /* 修正：ボタン類をGridの1行目・右端に配置 */
    header>div:last-of-type {
      grid-row: 1;
      justify-self: end;
    }

    /* 凡例を横並びにするためのスタイル */
    .mobile-status-legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      margin-top: 12px;
      font-size: 13px;
      color: #6b7280;
    }

    .mobile-status-legend p {
      margin: 0;
      width: 100%;
      text-align: center;
    }

    .mobile-status-legend .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 0;
      /* gapを使用するためマージンを削除 */
    }

    .mobile-status-legend .legend-dot {
      content: '●';
      display: inline-block;
      margin-right: 8px;
      font-size: 0.85em;
      opacity: 0.95;
    }

    .mobile-status-legend .legend-dot.available {
      color: #10b981;
    }

    .mobile-status-legend .legend-dot.limited {
      color: #f59e0b;
    }

    .mobile-status-legend .legend-dot.expired,
    .mobile-status-legend .legend-dot.unavailable {
      color: #ef4444;
    }

    .dark .mobile-status-legend {
      color: #d1d5db;
    }

    td.file-with-status {
      position: relative;
      padding-left: 30px;
    }

    td.file-with-status::before {
      content: '●';
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85em;
      opacity: 0.95;
    }

    td.file-with-status.available::before {
      color: #10b981;
    }

    td.file-with-status.limited::before {
      color: #f59e0b;
    }

    td.file-with-status.expired::before,
    td.file-with-status.unavailable::before {
      color: #ef4444;
    }

    /* モバイル表示で非表示にする列を指定 */
    td.status {
      display: flex;
      align-items: center;
      position: relative;
      white-space: nowrap;
      padding-left: 25px;
      /* 中黒分の余白 */
    }

    td.status::before {
      content: '●';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85em;
      opacity: 0.95;
    }

    td.status.available::before {
      color: #10b981;
    }

    td.status.limited::before {
      color: #f59e0b;
    }

    td.status.expired,
    td.status.unavailable,
    td.status.progress::before {
      color: #ef4444;
    }

    td.status .status-text {
      margin-left: 4px;
      /* 文字を少し左に */
    }

    /* 列幅は自動、最小幅は設定 */
    th#col-status {
      width: auto;
      min-width: 120px;
    }

    th#col-update,
    td[data-translate^="date-"] {
      display: table-cell;
      /* 見出しが消えないように */
      width: auto;
      white-space: nowrap;
    }

    /* デスクトップ表示での凡例非表示 */
    @media (min-width: 641px) {
      .mobile-status-legend {
        display: none;
      }

      /* ステータス列の文字だけ左に寄せるラッパー */
      td.status {
        display: flex;
        align-items: center;
        position: relative;
        white-space: nowrap;
        padding-left: 25px;
        /* 中黒分の余白 */
      }

      td.status::before {
        content: '●';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.85em;
        opacity: 0.95;
      }

      td.status.available::before {
        color: #10b981;
      }

      td.status.limited::before {
        color: #f59e0b;
      }

      td.status.expired,
      td.status.unavailable,
      td.status.progress::before {
        color: #ef4444;
      }

      td.status .status-text {
        margin-left: 8px;
        /* 中黒との間隔 */
      }

      /* 列幅は自動、言語による文字数を吸収 */
      th#col-status {
        width: auto;
        min-width: 120px;
      }

      /* 最終更新列は固定せず auto */
      th#col-update,
      td[data-translate^="date-"] {
        display: table-cell;
        width: auto;
        white-space: nowrap;
      }

    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <a href="https://line-0707.github.io/Acts/index.html" class="logo" aria-hidden="true"><img src="source/icon.webp"
          alt="ИНФ"></a>
      <div class="title-block">
        <div class="title-block-inner">
          <a href="https://line-0707.github.io/Acts/index.html" class="title-link">
            <h1 id="page-title" data-translate="page-title">ИНФОРМАЦИОННАЯ САЙТА</h1>
          </a>
          <p class="lead" id="page-subtitle" data-translate="page-subtitle">Сводка опубликованных документов и ресурсов
          </p>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:4px;">
        <button class="theme-toggle" id="theme-btn" aria-label="Toggle theme">
          <span class="material-icons" id="theme-icon">light_mode</span>
        </button>
        <div class="lang-select">
          <select id="lang-select" aria-label="Language selector">
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="ja">日本語</option>
          </select>
        </div>
      </div>
    </header>

    <section class="card">
      <table aria-label="Документы" id="docs-table">
        <thead>
          <tr>
            <th id="col-file" data-translate="col-file">Файлы</th>
            <th id="col-status" data-translate="col-status">
              <span class="status-text">Статус</span>
            </th>
            <th id="col-update" data-translate="col-update">Последнее обновление</th>
          </tr>
        </thead>

      </table>
      <div style="margin-top:12px" class="muted" id="note-text" data-translate="note-1">1. Некоторые данные отсутствуют.
        Исправлений нет.</div>

      <div class="mobile-status-legend">
        <p><strong data-translate="legend-title">凡例：</strong></p>
        <div class="legend-item"><span class="legend-dot available">●</span><span
            data-translate="status-legend-available">利用可能</span></div>
        <div class="legend-item"><span class="legend-dot limited">●</span><span
            data-translate="status-legend-limited">制限あり</span></div>
        <div class="legend-item"><span class="legend-dot expired">●</span><span
            data-translate="status-legend-expired">期限切れ / 利用不可</span></div>
      </div>
    </section>
    <table aria-label="Документы" id="docs-table">
      <thead>
        <tr>
          <th id="col-file">Файлы</th>
          <th id="col-status">Статус</th>
          <th id="col-update">Последнее обновление</th>
        </tr>
      </thead>
      <tbody>
        <!-- CSVから自動生成 -->
      </tbody>
    </table>

    <footer>
      <span id="author-text" data-translate="author">Создано: Юя Камошита с ChatGPT</span>
      <span class="last-update" id="auto-last">—</span>
    </footer>
  </div>

  <script>
    const themeBtn = document.getElementById('theme-btn');
    const themeIcon = document.getElementById('theme-icon');
    const langSelect = document.getElementById('lang-select');
    let currentLang = 'ru';

    function setTheme(theme) {
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
        themeIcon.textContent = 'dark_mode';
        themeIcon.style.color = '#ffffff';
      } else {
        document.documentElement.classList.remove('dark');
        themeIcon.textContent = 'light_mode';
        themeIcon.style.color = '#0f172a';
      }
    }

    themeBtn.addEventListener('click', () => {
      setTheme(document.documentElement.classList.contains('dark') ? 'light' : 'dark');
    });

    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    setTheme(prefersDark ? 'dark' : 'light');

    function formatDisplayDate(dateInput, lang = 'ru', withTime = false) {
      const d = new Date(dateInput);
      if (isNaN(d.getTime())) return dateInput;
      const day = d.getDate();
      const year = d.getFullYear();
      const hours = d.getHours().toString().padStart(2, '0');
      const minutes = d.getMinutes().toString().padStart(2, '0');
      if (lang === 'ru') {
        const monthName = new Intl.DateTimeFormat('ru', {
          month: 'long'
        }).format(d);
        const datePart = `${day} ${monthName} ${year}г.`;
        return withTime ? `${datePart}, ${hours}:${minutes}` : datePart;
      } else if (lang === 'en') {
        const datePart = new Intl.DateTimeFormat('en-US', {
          month: 'long',
          day: 'numeric',
          year: 'numeric'
        }).format(d);
        return withTime ? `${datePart}, ${hours}:${minutes}` : datePart;
      } else if (lang === 'ja') {
        const month = d.getMonth() + 1;
        const datePart = `${year}年${month}月${day}日`;
        return withTime ? `${datePart} ${hours}:${minutes}` : datePart;
      } else {
        return withTime ? `${d.toLocaleString(lang)}` : `${d.toLocaleDateString(lang)}`;
      }
    }

    function setPreserveInlineChildren(el, text) {
      if (!el) return;
      const span = el.querySelector('.status-text');
      if (span) {
        span.textContent = text;
        return;
      }

      const a = el.querySelector('a');
      if (a) {
        a.textContent = text;
        return;
      }

      const s = el.querySelector('s');
      if (s) {
        s.textContent = text;
        return;
      }

      const sup = el.querySelector('sup');
      if (sup) {
        const rest = Array.from(el.children).filter(ch => ch.tagName === 'SUP').map(ch => ch.outerHTML).join('');
        el.innerHTML = text + rest;
        return;
      }

      el.textContent = text;
    }

    function updateLastModified(lang = currentLang) {
      const lastModRaw = document.lastModified;
      const lastModDate = new Date(lastModRaw);
      const fallback = new Date();
      const finalDate = isNaN(lastModDate.getTime()) ? fallback : lastModDate;
      const prefix = {
        ru: 'Последнее обновление:',
        en: 'Last updated:',
        ja: '最終更新：'
      }[lang] || 'Last updated:';
      document.getElementById('auto-last').textContent = `${prefix} ${formatDisplayDate(finalDate.toISOString(), lang, true)}`;
    }

    const translations = {
      en: {
        'page-title': 'INFORMATION SITE',
        'page-subtitle': 'Summary of published documents and resources',
        'col-file': 'Files',
        'col-status': 'Status',
        'col-update': 'Last update',
        'note-1': '1. Some data is missing. No corrections.',
        'author': 'Created by Yuya Kamoshita with ChatGPT',
      },
      ja: {
        'page-title': 'Information',
        'page-subtitle': '公開された資料とリソースの一覧',
        'col-file': 'ファイル',
        'col-status': 'ステータス',
        'col-update': '最終更新日',
        'note-1': '1. 一部のデータは欠落しています。修正はありません。',
        'author': '作者：鴨下友哉&ChatGPT使用',
      },
      ru: {
        'page-title': 'ИНФОРМАЦИОННАЯ САЙТА',
        'page-subtitle': 'Сводка опубликованных документов и ресурсов',
        'col-file': 'Файлы',
        'col-status': 'Статус',
        'col-update': 'Последнее обновление',
        'note-1': '1. Некоторые данные отсутствуют. Исправлений нет.',
        'author': 'Создано: Юя Камошита с ChatGPT',
      }
    };

    function setLang(lang) {
      currentLang = lang;
      const map = translations[lang] || translations['ru'];
      Object.keys(map).forEach(id => {
        const el = document.querySelector(`[data-translate="${id}"]`);
        if (el) setPreserveInlineChildren(el, map[id]);
      });
      document.querySelectorAll('[data-date]').forEach(el => {
        const iso = el.getAttribute('data-date');
        if (!iso || iso.trim() === '') return;
        const formatted = formatDisplayDate(iso, lang, false);
        setPreserveInlineChildren(el, formatted);
      });
      updateLastModified(lang);
      if (langSelect) langSelect.value = lang;
      updateMobileView();
    }

    // かっこ書きを削除する対象のデータ翻訳キー
    const noParenFiles = ['file-1', 'file-8', 'file-2', 'file-3', 'file-4', 'file-7'];

    function updateMobileView() {
      const isMobile = window.matchMedia("(max-width: 640px)").matches;
      document.querySelectorAll('#docs-table tbody tr').forEach(row => {
        const fileCell = row.querySelector('[data-translate^="file-"]');
        const statusCell = row.querySelector('.status');
        if (!fileCell) return;

        // ステータスクラスを判定
        let statusClass = '';
        if (statusCell) {
          if (statusCell.classList.contains('available')) statusClass = 'available';
          else if (statusCell.classList.contains('limited')) statusClass = 'limited';
          else if (statusCell.classList.contains('expired') || statusCell.classList.contains('unavailable') || statusCell.classList.contains('progress')) statusClass = 'expired';
        }

        if (isMobile) {
          fileCell.classList.add('file-with-status', statusClass);
        } else {
          fileCell.classList.remove('file-with-status', 'available', 'limited', 'expired', 'unavailable', 'progress');
        }
      });
    }

    if (langSelect) {
      langSelect.addEventListener('change', (e) => {
        setLang(e.target.value);
      });
    }

    window.addEventListener('resize', updateMobileView);

    (function init() {
      const initial = langSelect ? langSelect.value || 'ru' : 'ru';
      setLang(initial);
      updateMobileView();
    })();
    async function loadCSVData() {
      const sheetId = "1Rvr4RwirK8-ygKXG3Qyq6Bf4OvGZ7YjsxiAb4ZI2Xeo";
      const sheetName = "index-data";
      const jsonUrl = `https://docs.google.com/spreadsheets/d/1Rvr4RwirK8-ygKXG3Qyq6Bf4OvGZ7YjsxiAb4ZI2Xeo/gviz/tq?sheet=index-data&tqx=out:json`;
      const tableBody = document.querySelector("#docs-table tbody");
      if (!tableBody) return;

      try {
        const response = await fetch(jsonUrl);
        const text = await response.text();

        // gvizレスポンスは "/*O_o*/ google.visualization.Query.setResponse(...)" 形式
        const json = JSON.parse(text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1));
        const rows = json.table.rows;
        const headers = json.table.cols.map(c => c.label.toLowerCase());

        tableBody.innerHTML = "";

        rows.forEach(row => {
          const record = Object.fromEntries(headers.map((h, i) => [h, (row[i]?.v ?? "").trim()]));
          const titleRu = record["files"];
          const titleEn = record["en"];
          const titleJa = record["jp"];
          const url = record["link"];
          const statusCode = record["status"];
          const dateStr = record["last_update"];

          if (!titleRu) return;

          // カテゴリ行（cat[...]）
          const catMatch = titleRu.match(/^cat\[(.+?)\]$/i);
          if (catMatch) {
            const tr = document.createElement("tr");
            tr.className = "subcat";
            const titleTextRu = catMatch[1];
            const titleTextEn = titleEn?.match(/^cat\[(.+?)\]$/i)?.[1] ?? titleTextRu;
            const titleTextJa = titleJa?.match(/^cat\[(.+?)\]$/i)?.[1] ?? titleTextRu;
            const td = document.createElement("td");
            td.colSpan = 3;
            td.dataset.ru = titleTextRu;
            td.dataset.en = titleTextEn;
            td.dataset.ja = titleTextJa;
            td.textContent = titleTextRu;
            tr.appendChild(td);
            tableBody.appendChild(tr);
            return;
          }

          // 通常行
          const tr = document.createElement("tr");
          let statusClass = "", statusText = {};
          if (statusCode === "g") {
            statusClass = "available";
            statusText = { ru: "Доступный", en: "Available", ja: "利用可能" };
          } else if (statusCode === "e") {
            statusClass = "limited";
            statusText = { ru: "Ограниченный доступ", en: "Limited Access", ja: "制限あり" };
          } else if (statusCode === "ex") {
            statusClass = "expired";
            statusText = { ru: "Истекший", en: "Expired", ja: "期限切れ" };
          }

          const tdFile = document.createElement("td");
          tdFile.dataset.ru = titleRu;
          tdFile.dataset.en = titleEn;
          tdFile.dataset.ja = titleJa;
          if (url && url !== "#") {
            tdFile.innerHTML = `<a href="${url}" target="_blank" rel="noopener">${titleRu}</a>`;
          } else {
            tdFile.innerHTML = `<a href="#" class="broken-link" onclick="event.preventDefault();" aria-disabled="true">${titleRu}</a>`;
          }

          const tdStatus = document.createElement("td");
          tdStatus.className = `status ${statusClass}`;
          tdStatus.dataset.statusRu = statusText.ru;
          tdStatus.dataset.statusEn = statusText.en;
          tdStatus.dataset.statusJa = statusText.ja;
          tdStatus.innerHTML = `<span class="status-text">${statusText[currentLang] ?? ""}</span>`;

          const tdDate = document.createElement("td");
          if (dateStr && !isNaN(Date.parse(dateStr))) {
            const iso = new Date(dateStr).toISOString();
            tdDate.setAttribute("data-date", iso);
            tdDate.textContent = formatDisplayDate(iso, currentLang);
          } else {
            tdDate.textContent = "—";
          }

          tr.appendChild(tdFile);
          tr.appendChild(tdStatus);
          tr.appendChild(tdDate);
          tableBody.appendChild(tr);
        });

        updateMobileView();
      } catch (err) {
        console.error("❌ シート読み込みエラー:", err);
      }
    }
    document.addEventListener("DOMContentLoaded", loadCSVData);


    // 言語切替時にCSV部分も翻訳
    function updateCSVLang(lang) {
      document.querySelectorAll("#docs-table tbody tr").forEach(tr => {
        const td = tr.querySelector("td:first-child");
        const tdStatus = tr.querySelector("td.status");
        const tdDate = tr.querySelector("td[data-date]");

        if (tr.classList.contains("subcat")) {
          td.textContent = td.dataset[lang] ?? td.dataset.ru;
          return;
        }

        if (td && td.dataset[lang]) {
          const a = td.querySelector("a");
          if (a) a.textContent = td.dataset[lang];
        }

        if (tdStatus && tdStatus.dataset[`status${lang.charAt(0).toUpperCase() + lang.slice(1)}`]) {
          tdStatus.querySelector(".status-text").textContent =
            tdStatus.dataset[`status${lang.charAt(0).toUpperCase() + lang.slice(1)}`];
        }

        if (tdDate && tdDate.dataset.date) {
          tdDate.textContent = formatDisplayDate(tdDate.dataset.date, lang);
        }
      });
    }

    // setLangの拡張
    const originalSetLang = setLang;
    setLang = function (lang) {
      originalSetLang(lang);
      updateCSVLang(lang);
    };

    // ページ読み込み時にCSVをロード
    document.addEventListener("DOMContentLoaded", loadCSVData);
  </script>
</body>

</html>